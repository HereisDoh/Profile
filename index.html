<script>
const frontPage = document.getElementById('frontPage');
const cameraPage = document.getElementById('cameraPage');
const cameraIcon = document.getElementById('cameraIcon');
const homeIcon = document.getElementById('homeIcon');
const video = document.getElementById('camera');
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const scoreDisplay = document.getElementById('scoreDisplay');

let currentGame = null;
let animationFrameId;
let stars = [];
let playerX = 0;
let score = 0;

cameraIcon.addEventListener('click', () => {
  frontPage.style.display = 'none';
  cameraPage.style.display = 'flex';

  navigator.mediaDevices.getUserMedia({ video: true })
    .then(stream => {
      video.srcObject = stream;
      video.play();
      canvas.width = video.videoWidth || window.innerWidth;
      canvas.height = video.videoHeight || window.innerHeight;
    })
    .catch(err => {
      alert('Camera access denied or not available.');
    });
});

homeIcon.addEventListener('click', () => {
  cameraPage.style.display = 'none';
  frontPage.style.display = 'flex';
  let tracks = video.srcObject ? video.srcObject.getTracks() : [];
  tracks.forEach(track => track.stop());
  video.srcObject = null;
  cancelAnimationFrame(animationFrameId);
  stars = [];
  score = 0;
  scoreDisplay.textContent = 'Score: 0';
});

canvas.addEventListener('mousemove', (e) => {
  playerX = e.offsetX;
});

// ‚≠ê Function to draw a 5-point star
function drawStar(ctx, x, y, radius, points, inset, color) {
  ctx.save();
  ctx.beginPath();
  ctx.translate(x, y);
  ctx.moveTo(0, -radius);
  for (let i = 0; i < points; i++) {
    ctx.rotate(Math.PI / points);
    ctx.lineTo(0, -radius * inset);
    ctx.rotate(Math.PI / points);
    ctx.lineTo(0, -radius);
  }
  ctx.closePath();
  ctx.fillStyle = color;
  ctx.fill();
  ctx.restore();
}

function startGame(game) {
  currentGame = game;
  stars = [];
  score = 0;
  scoreDisplay.textContent = 'Score: 0';
  animationFrameId = requestAnimationFrame(gameLoop);
}

function gameLoop() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  if(currentGame === 'catch') {
    if(Math.random() < 0.01) {
      stars.push({x: Math.random()*canvas.width, y: 0, size: 20});
    }

    for(let i=0;i<stars.length;i++){
      let s = stars[i];
      s.y += 2;

      // draw a yellow star instead of a circle
      drawStar(ctx, s.x, s.y, s.size, 5, 0.5, "yellow");

      if(s.y > canvas.height-40 && Math.abs(s.x-playerX)<50){
        stars.splice(i,1);
        i--;
        score += 1;
        scoreDisplay.textContent = 'Score: '+score;
      } else if(s.y > canvas.height){
        stars.splice(i,1);
        i--;
      }
    }

    ctx.fillStyle = 'red';
    ctx.fillRect(playerX-50, canvas.height-30, 100, 20);
  }

  animationFrameId = requestAnimationFrame(gameLoop);
}

function applyFilter(filter) {
  video.style.filter = filter;
}
</script>
